üìù Especificaci√≥n T√©cnica: Extracci√≥n OCR M√©dica de Alta Precisi√≥n
Instrucci√≥n para el Agente de Replit: Implementa las siguientes reglas de l√≥gica, procesamiento y estructura de datos en el sistema de extracci√≥n basado en Gemini 2.5 Flash.

1. Capa de Inteligencia General (Cadena de Verificaci√≥n)
Aplica a todos los campos de texto libre.

Protocolo de Procesamiento:

Paso 1 (Captura): Realizar una transcripci√≥n literal de los caracteres detectados (aunque contengan errores).

Paso 2 (Validaci√≥n Sem√°ntica): - Nombres: Corregir ortograf√≠a basada en onom√°stica mexicana (ej. "Gonzalez" -> "Gonz√°lez") pero respetar graf√≠as si parecen apellidos extranjeros (ej. franceses) y son legibles.

M√©dico: Cruzar diagn√≥sticos con CIE-10 y medicamentos con Vadem√©cum (ej. "Hipertencion" -> "Hipertensi√≥n", "Amoxisilina" -> "Amoxicilina").

Paso 3 (Filtro de Ruido): Si el texto tras el an√°lisis no tiene sentido fon√©tico ni m√©dico (gibberish), marcar como [ILEGIBLE].

2. Capa de Reglas Espec√≠ficas: GNP SEGUROS
Activar estas reglas cuando el documento sea identificado como GNP.

L√≥gica de Selecci√≥n de Checkboxes:

Anclaje a la Izquierda: En GNP, el recuadro o espacio para marcar est√° a la IZQUIERDA de la opci√≥n. Una marca (X, ‚úì, mancha) selecciona la palabra situada a su DERECHA.

Jerarqu√≠a M√°xima (C√≠rculo): Si una palabra est√° rodeada por un c√≠rculo manual, esa es la opci√≥n seleccionada, invalidando cualquier otra marca en cuadros adyacentes.

L√≥gica de Subrayado: Una l√≠nea debajo de una palabra (horizontal, diagonal o parcial) cuenta como selecci√≥n. En opciones compuestas (ej. "Corta estancia / ambulatoria"), subrayar cualquier parte selecciona la opci√≥n completa.

3. Estructura del JSON y Objetos de Auditor√≠a
Cada campo extra√≠do debe seguir este esquema de "Trazabilidad Total".

Esquema por campo (Ejemplo: diagnostico):

valor_final: (String) El dato limpio y corregido.

_audit: (Objeto)

extraccion_literal: (String) Lo que la IA vio originalmente antes de corregir.

correccion_realizada: (Boolean) true si hubo cambios entre lo literal y lo final.

metodo_deteccion: (Enum) ["anclaje_izquierda", "circulo_envolvente", "subrayado", "texto_manuscrito"].

confianza: (Enum) ["alta", "media", "baja"].

4. Objeto de Metadatos Globales (metadata_ia)
A√±adir al final de cada JSON para observaciones de alto nivel.

JSON
"metadata_ia": {
  "analisis_discrepancias": "Texto: Reportar si un dato (ej. PA) aparece en la nota m√©dica pero su campo oficial est√° vac√≠o.",
  "alertas_legibilidad": "Texto: Listar campos marcados como [ILEGIBLE].",
  "ajustes_contextuales": "Texto: Resumen de correcciones ortogr√°ficas o m√©dicas realizadas."
}
5. Instrucciones Cr√≠ticas de Programaci√≥n
Regla de Exclusividad Geogr√°fica: No traslades informaci√≥n. Si el recuadro de un signo vital est√° vac√≠o en el papel, el JSON debe devolver null, aunque la informaci√≥n aparezca en la descripci√≥n de la exploraci√≥n f√≠sica.

Formato de Salida: Solo devolver JSON v√°lido. No incluir explicaciones fuera del objeto.

Manejo de Ilegibilidad: Si un campo es totalmente ilegible, valor_final ser√° null y _audit.extraccion_literal ser√° "[ILEGIBLE]".