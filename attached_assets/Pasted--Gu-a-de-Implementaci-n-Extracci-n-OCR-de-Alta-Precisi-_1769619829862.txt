üöÄ Gu√≠a de Implementaci√≥n: Extracci√≥n OCR de Alta Precisi√≥n (Gemini 2.5 Flash)
Para: Agente de Replit Objetivo: Transcripci√≥n m√©dica con trazabilidad total y l√≥gica espec√≠fica de seguros.

1. Capa de Inteligencia General (Core Reasoning)
Estas reglas aplican para CUALQUIER documento procesado por el sistema.

A. Cadena de Verificaci√≥n (CoV) y Control de Gibberish
La IA debe realizar un proceso de pensamiento en tres pasos para cada campo de texto:

Captura Visual: Transcribir exactamente los caracteres detectados (aunque no tengan sentido).

Validaci√≥n de Contexto (M√©xico):

M√©dico: Comparar contra CIE-10 y Vademecum (ej: "hipertencion" ‚Üí "hipertensi√≥n").

Nombres/Entidades: Validar contra onom√°stica mexicana y nombres de hospitales conocidos. Si el nombre parece extranjero (ej: franc√©s), mantener la graf√≠a original si es clara.

Filtro de Ruido: Si el texto es incoherente tras el an√°lisis (ej: "x12$"), marcar como [ILEGIBLE].

B. Objeto de Auditor√≠a Universal (Estructura JSON)
Para cada campo extra√≠do (ej: nombre_paciente), el JSON debe incluir un campo hermano de auditor√≠a (nombre_paciente_audit).

Estructura requerida por campo:

valor_final: El dato limpio, corregido y listo para la base de datos.

_audit:

extraccion_literal: Lo que la IA vio originalmente (con errores o ruidos).

correccion_realizada: Boolean (true/false).

metodo_deteccion: (anclaje_izquierda, circulo, subrayado, texto_manuscrito).

confianza: (alta, media, baja).

2. Capa de Reglas Espec√≠ficas: GNP SEGUROS
Estas reglas son EXCLUSIVAS para los formatos de GNP Seguros.

A. L√≥gica de Selecci√≥n (Checkboxes)
Anclaje a la Izquierda: En los formatos GNP, el espacio para marcar (recuadro o l√≠nea) se encuentra a la IZQUIERDA de la opci√≥n de texto. Por lo tanto, una marca detectada selecciona la opci√≥n de su DERECHA.

Prioridad del C√≠rculo: Si una opci√≥n de texto est√° rodeada por un c√≠rculo manual, esa opci√≥n es la seleccionada, anulando cualquier marca (X, ‚úì) que haya en los cuadros adyacentes. El c√≠rculo tiene jerarqu√≠a m√°xima.

B. L√≥gica de Subrayado
Detecci√≥n de Proximidad Inferior: Una l√≠nea debajo de una palabra cuenta como selecci√≥n.

Unidad Indivisible: En opciones compuestas (ej: "Corta estancia / ambulatoria"), subrayar solo "ambulatoria" selecciona la opci√≥n completa.

3. Instrucciones de Programaci√≥n para el Agente de Replit
Dile al Agente de Replit lo siguiente para que configure el sistema correctamente:

Modificaci√≥n del Prompt del Sistema:

"Act√∫a como un experto en OCR m√©dico. Para cada campo, llena el valor_final bas√°ndote en la correcci√≥n sem√°ntica y el objeto _audit con la extraccion_literal encontrada. Si es GNP, aplica la regla de 'Marca a la izquierda selecciona opci√≥n a la derecha'."

Regla de Exclusividad de Datos (Vital):

"No traslades informaci√≥n entre secciones. Si el recuadro de 'Presi√≥n Arterial' est√° vac√≠o, el campo signos_vitales.presion_arterial debe ser null, incluso si el dato aparece escrito en el p√°rrafo de 'Exploraci√≥n F√≠sica'. Mant√©n cada dato en su coordenada geogr√°fica original."

Implementaci√≥n del Objeto de Comentarios (metadata_ia): A√±adir al final del JSON:

JSON
"metadata_ia": {
  "analisis_discrepancias": "Menciona aqu√≠ si un dato falta en su recuadro pero aparece en notas m√©dicas.",
  "alertas_legibilidad": "Lista campos marcados como [ILEGIBLE] para revisi√≥n humana.",
  "ajustes_contextuales": "Notas sobre correcciones de nombres o medicamentos realizadas."
}
4. Ejemplo de Salida Esperada (JSON Auditado)
Si el m√©dico escribe "Amoxisilina" en un formulario de GNP y tacha con una X el cuadro a la izquierda de "Accidente":

JSON
{
  "medicamento": "Amoxicilina",
  "medicamento_audit": {
    "extraccion_literal": "Amoxisilina",
    "correccion_realizada": true,
    "metodo_deteccion": "texto_manuscrito"
  },
  "causa_atencion": "Accidente",
  "causa_atencion_audit": {
    "extraccion_literal": "X",
    "correccion_realizada": false,
    "metodo_deteccion": "anclaje_izquierda"
  },
  "metadata_ia": {
    "ajustes_contextuales": "Se corrigi√≥ ortograf√≠a de Amoxicilina bas√°ndose en Vademecum m√©dico."
  }
}