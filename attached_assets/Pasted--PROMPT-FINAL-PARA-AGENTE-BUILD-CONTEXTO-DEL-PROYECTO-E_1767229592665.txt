ğŸš€ PROMPT FINAL PARA AGENTE BUILD
CONTEXTO DEL PROYECTO
EstÃ¡s trabajando en un Auditor MÃ©dico IA que procesa informes de aseguradoras mexicanas (GNP y METLIFE). El sistema:

Extrae datos de PDFs usando Gemini AI con schemas especÃ­ficos por aseguradora
Valida contra reglas de scoring en services/scoring-engine.ts
Calcula un score de 0-100 basado en cumplimiento de reglas
CÃ³digo base relevante:

NormalizaciÃ³n (Fase 1): Sistema en services/field-mapper.ts que mapea campos de cada aseguradora a un schema estÃ¡ndar usando configs en config/aseguradora-configs.ts
Reglas de validaciÃ³n: Actualmente en services/scoring-engine.ts con DEFAULT_SCORING_RULES[]
UI de configuraciÃ³n: Componente RuleConfigurator.tsx que permite editar severidad/puntos de reglas
OBJETIVO - IMPLEMENTAR OPCIONES A + B
âœ… OPCIÃ“N A: Normalizar ~30 Campos CrÃ­ticos
Instrucciones:

Completa el mapeo de los siguientes 30 campos crÃ­ticos en ambas aseguradoras (GNP y METLIFE) dentro de config/aseguradora-configs.ts:
PACIENTE (6 campos):
- paciente.nombre
- paciente.apellido_paterno  
- paciente.apellido_materno
- paciente.edad
- paciente.sexo
- paciente.fecha_nacimiento (nuevo)
PÃ“LIZA (3 campos):
- poliza.numero
- poliza.certificado (nuevo)
- poliza.asegurado_titular (nuevo, booleano)
MÃ‰DICO TRATANTE (8 campos):
- medico_tratante.nombre
- medico_tratante.apellido_paterno
- medico_tratante.apellido_materno
- medico_tratante.cedula_profesional
- medico_tratante.especialidad
- medico_tratante.telefono
- medico_tratante.correo
- medico_tratante.rfc (nuevo, solo MetLife lo requiere)
FECHAS (5 campos):
- fecha.ingreso
- fecha.egreso
- fecha.diagnostico
- fecha.cirugia
- fecha.informe
DIAGNÃ“STICO (3 campos):
- diagnostico.codigo_cie
- diagnostico.descripcion
- diagnostico.codigo_cie_secundario (array)
INTERVENCIÃ“N QUIRÃšRGICA (3 campos):
- intervencion_qx.hubo_cirugia
- intervencion_qx.tipo_anestesia
- intervencion_qx.descripcion
SIGNOS VITALES (2 campos - SOLO GNP):
- signos_vitales.temperatura
- signos_vitales.presion_sistolica
VALIDACIÃ“N CRÃTICA: Ejecuta npm run validate-paths para validar los 30 paths contra los PDFs reales en attached_assets/:

Informe_medico_GNP_1766215603488.pdf
Informe_medico_Metlife_1766206666755.pdf
Corrige errores reportados por el script de validaciÃ³n antes de continuar.

Actualiza types/standardized-schema.ts si es necesario para incluir nuevos campos (fecha_nacimiento, certificado, etc.)

âœ… OPCIÃ“N B: Organizar Reglas en Archivos Separados + UI Mejorado
Parte 1: Crear archivos de reglas separados

Crea 3 nuevos archivos:

services/scoring-rules-general.ts - Reglas aplicables a TODAS las aseguradoras (â‰¥3 reglas):
import { ScoringRule } from "../types";
export const REGLAS_GENERALES: ScoringRule[] = [
  {
    id: 'diag_falta',
    name: 'DiagnÃ³stico faltante',
    level: 'CRÃTICO',
    points: 25,
    description: 'El diagnÃ³stico definitivo es la base de la reclamaciÃ³n.',
    providerTarget: 'ALL',
    validator: (data) => {
      // Intentar leer de datos normalizados si existen
      if (data._normalized?.datos?.diagnostico?.descripcion) {
        return !data._normalized.datos.diagnostico.descripcion.trim();
      }
      // Fallback a datos raw
      return !data.diagnostico?.diagnostico_definitivo?.trim();
    },
    affectedFields: ['diagnostico.diagnostico_definitivo']
  },
  // ... mÃ­nimo 2 reglas mÃ¡s
];
services/scoring-rules-gnp.ts - Reglas especÃ­ficas de GNP (â‰¥3 reglas):
export const REGLAS_GNP: ScoringRule[] = [
  {
    id: 'gnp_signos',
    name: 'Signos Vitales Incompletos',
    level: 'IMPORTANTE',
    points: 10,
    description: 'GNP requiere signos vitales (PresiÃ³n/Temperatura) para el dictamen.',
    providerTarget: 'GNP',
    validator: (data) => !data.signos_vitales?.presion_arterial || !data.signos_vitales?.temperatura,
    affectedFields: ['signos_vitales.presion_arterial']
  },
  // ... mÃ­nimo 2 reglas mÃ¡s
];
services/scoring-rules-metlife.ts - Reglas especÃ­ficas de MetLife (â‰¥3 reglas):
export const REGLAS_METLIFE: ScoringRule[] = [
  {
    id: 'metlife_rfc',
    name: 'RFC MÃ©dico Obligatorio',
    level: 'CRÃTICO',
    points: 20,
    description: 'MetLife requiere el RFC para validaciÃ³n de honorarios.',
    providerTarget: 'METLIFE',
    validator: (data) => !data.medico_tratante?.rfc?.trim(),
    affectedFields: ['medico_tratante.rfc']
  },
  // ... mÃ­nimo 2 reglas mÃ¡s
];
Parte 2: Actualizar services/scoring-engine.ts

Agrega funciÃ³n para obtener reglas segÃºn aseguradora:

import { REGLAS_GENERALES } from './scoring-rules-general';
import { REGLAS_GNP } from './scoring-rules-gnp';
import { REGLAS_METLIFE } from './scoring-rules-metlife';
export function getReglasParaAseguradora(provider: ProviderType): ScoringRule[] {
  const reglasEspecificas = provider === 'GNP' ? REGLAS_GNP : 
                           provider === 'METLIFE' ? REGLAS_METLIFE : [];
  return [...REGLAS_GENERALES, ...reglasEspecificas];
}
export const DEFAULT_SCORING_RULES = getReglasParaAseguradora('ALL');
Parte 3: Mejorar UI de RuleConfigurator.tsx

Agrega:

Tabs para alternar entre "Reglas Generales" y "Reglas EspecÃ­ficas"
Dropdown para seleccionar aseguradora (GNP/METLIFE) en tab "EspecÃ­ficas"
Badge visual para cada regla mostrando su categorÃ­a (GENERAL/GNP/METLIFE)
Ejemplo de estructura visual:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [GENERALES]  [ESPECÃFICAS â–¾]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”´ GENERAL | DiagnÃ³stico...  â”‚   â”‚
â”‚  â”‚ Nivel: [CRÃTICO â–¾]  Pts: 25  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ... mÃ¡s reglas                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ¯ DECISIONES DE IMPLEMENTACIÃ“N CONFIRMADAS
NormalizaciÃ³n automÃ¡tica: NO integrar aÃºn en geminiService.ts. Mantener infraestructura lista pero sin modificar flujo actual.

ValidaciÃ³n de paths: SÃ validar los 30 paths contra PDFs reales usando npm run validate-paths.

UI de reglas: Usar tabs + dropdown para seleccionar aseguradora al editar reglas especÃ­ficas.

Propiedad de validaciÃ³n: Mantener validator en lugar de migrar a check. Conservar compatibilidad con cÃ³digo existente.

Reglas de ejemplo: Crear reglas genÃ©ricas de demostraciÃ³n coherentes con el dominio mÃ©dico (3 generales + 3 GNP + 3 MetLife).

âœ… CHECKLIST DE VALIDACIÃ“N POST-IMPLEMENTACIÃ“N
CompilaciÃ³n:

 npm run dev ejecuta sin errores TypeScript
 No hay imports faltantes ni referencias rotas
NormalizaciÃ³n (OpciÃ³n A):

 config/aseguradora-configs.ts tiene mappings de 30 campos para GNP
 config/aseguradora-configs.ts tiene mappings de 30 campos para METLIFE
 types/standardized-schema.ts incluye todos los campos del schema
 npm run validate-paths ejecuta sin errores crÃ­ticos
Reglas (OpciÃ³n B):

 Existe services/scoring-rules-general.ts con â‰¥3 reglas
 Existe services/scoring-rules-gnp.ts con â‰¥3 reglas
 Existe services/scoring-rules-metlife.ts con â‰¥3 reglas
 services/scoring-engine.ts tiene funciÃ³n getReglasParaAseguradora()
 Las reglas generales intentan usar data._normalized.* con fallback a data.*
UI (OpciÃ³n B):

 RuleConfigurator.tsx muestra tabs "Generales" y "EspecÃ­ficas"
 Tab "EspecÃ­ficas" tiene dropdown GNP/METLIFE
 Cada regla tiene badge visual (GENERAL/GNP/METLIFE)
 Los cambios se guardan correctamente al cerrar modal
Prueba funcional:

 Subir PDF de GNP â†’ score se calcula con reglas generales + GNP
 Subir PDF de METLIFE â†’ score se calcula con reglas generales + METLIFE
 Abrir AuditorÃ­a de Reglas â†’ se pueden editar niveles y puntos
 Consola del navegador NO muestra errores TypeScript
ğŸš¨ NOTAS IMPORTANTES
Libertad creativa: Si encuentras una forma mÃ¡s Ã³ptima o eficiente de implementar algo (mejores parsers, validaciones mÃ¡s robustas, UI mÃ¡s intuitiva), tienes libertad de hacerlo. Estas son sugerencias, no restricciones absolutas.

Pregunta si hay dudas: Si algo no te queda claro sobre el output esperado o necesitas mÃ¡s contexto sobre los PDFs/schemas, pregÃºntame antes de ejecutar.

No romper funcionalidad existente: El Dashboard y flujo actual deben seguir funcionando al 100%. Los cambios son aditivos, no destructivos.